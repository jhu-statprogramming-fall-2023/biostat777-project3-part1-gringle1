<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rpart">
<title>Example Analysis • rpart</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example Analysis">
<meta property="og:description" content="rpart">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rpart</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.1.21</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/my-vignette.html">Example Analysis</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bethatkinson/rpart/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Example Analysis</h1>
                        <h4 data-toc-skip class="author">Grace
Ringlein</h4>
            
            <h4 data-toc-skip class="date">2023-12-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bethatkinson/rpart/blob/HEAD/vignettes/my-vignette.Rmd" class="external-link"><code>vignettes/my-vignette.Rmd</code></a></small>
      <div class="d-none name"><code>my-vignette.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>We illustrate use of the <strong>rpart</strong> package using data
from Freedom House and the United Nations to investigate the
relationship between the civil liberty ranking and political rights
rankings related to freedom status (“Free”,“Not free”,and “Partially
Free”)?</p>
<p>Note that “Freedom status” is not meant to be used here a definitive
measure. This system is a likely a vast over-simplication of the nuances
of freedom, liberty and political climate. The data is used here to
explore how these designations were created using
<strong>rpart</strong>.</p>
<p>Data and data dictionary are available at <a href="https://github.com/rfordatascience/tidytuesday/blob/master/data/2022/2022-02-22/readme.md" class="external-link uri">https://github.com/rfordatascience/tidytuesday/blob/master/data/2022/2022-02-22/readme.md</a></p>
</div>
<div class="section level2">
<h2 id="set-up">Set up<a class="anchor" aria-label="anchor" href="#set-up"></a>
</h2>
<div class="section level3">
<h3 id="load-packages">Load packages<a class="anchor" aria-label="anchor" href="#load-packages"></a>
</h3>
<p>First we load the rpart package.</p>
<p>If <code>rpart</code> is not installed, install via:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"rpart"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bethatkinson/rpart" class="external-link">rpart</a></span><span class="op">)</span></span></code></pre></div>
<p>Additional packages used are:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">maps</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="download-data">Download data<a class="anchor" aria-label="anchor" href="#download-data"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"vignettes"</span>,<span class="st">"data"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"vignettes"</span>,<span class="st">"data"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"vignettes"</span>,<span class="st">"data"</span>,<span class="st">"freedom.rds"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="va">tuesdata</span> <span class="op">&lt;-</span> <span class="fu">tidytuesdayR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tidytuesdayR/man/tt_load.html" class="external-link">tt_load</a></span><span class="op">(</span><span class="fl">2022</span>, week <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">freedom</span> <span class="op">&lt;-</span> <span class="va">tuesdata</span><span class="op">$</span><span class="va">freedom</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">freedom</span>,<span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"vignettes"</span>,<span class="st">"data"</span>,<span class="st">"freedom.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>   <span class="va">freedom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"vignettes"</span>,<span class="st">"data"</span>,<span class="st">"freedom.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The data set spans 26 years and consists of 193 countries.</p>
<p>Plotting country freedom status, we can see that many countries in
North America, Europe, South and western South America, Southern Africa,
and Australia are classified as “Free”. Many African, west Asian, and
eastern European counties are classified “Not free”.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">world_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="external-link">map_data</a></span><span class="op">(</span><span class="st">"world"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">freedom_2020_plot</span> <span class="op">&lt;-</span> <span class="va">freedom</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span><span class="op">==</span><span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>region<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>     <span class="va">country</span><span class="op">==</span><span class="st">"United States of America"</span> <span class="op">~</span> <span class="st">"USA"</span>,</span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Kingdom"</span>,<span class="va">country</span><span class="op">)</span> <span class="op">~</span> <span class="st">"UK"</span>,</span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Antigua"</span>,<span class="va">country</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Antigua"</span>,</span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Bolivia"</span>,<span class="va">country</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Bolivia"</span>,</span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Iran"</span>,<span class="va">country</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Iran"</span>,</span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Lao"</span>,<span class="va">country</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Laos"</span>,</span>
<span>     <span class="va">country</span><span class="op">==</span><span class="st">"Democratic People's Republic of Korea"</span> <span class="op">~</span> <span class="st">"North Korea"</span>,</span>
<span>     <span class="va">country</span><span class="op">==</span><span class="st">"Republic of Korea"</span> <span class="op">~</span> <span class="st">"South Korea"</span>,</span>
<span>     <span class="va">country</span><span class="op">==</span><span class="st">"Viet Nam"</span> <span class="op">~</span> <span class="st">"Vietnam"</span>,</span>
<span>     <span class="va">country</span><span class="op">==</span><span class="st">"Czechia"</span> <span class="op">~</span> <span class="st">"Czech Republic"</span>,</span>
<span>     <span class="va">country</span><span class="op">==</span><span class="st">"Cabo Verde"</span> <span class="op">~</span> <span class="st">"Cape Verde"</span>,</span>
<span>     <span class="va">country</span><span class="op">==</span><span class="st">"Congo"</span> <span class="op">~</span> <span class="st">"Democratic Republic of the Congo"</span>,</span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Russia"</span>,<span class="va">country</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Russia"</span>,</span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Venezuela"</span>,<span class="va">country</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Venezuela"</span>,</span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Brunei"</span>,<span class="va">country</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Brunei"</span>,</span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Tanzania"</span>,<span class="va">country</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Tanzania"</span>,</span>
<span>     <span class="va">country</span><span class="op">==</span><span class="st">"Syrian Arab Republic"</span> <span class="op">~</span> <span class="st">"Syria"</span>,</span>
<span>     <span class="va">country</span><span class="op">==</span><span class="st">"Republic of Moldova"</span> <span class="op">~</span> <span class="st">"Moldova"</span>,</span>
<span>     <span class="va">country</span><span class="op">==</span><span class="st">"CÃƒÂ´te dÃ¢â‚¬â„¢Ivoire"</span><span class="op">~</span> <span class="st">"Ivory Coast"</span>,</span>
<span>     <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">region</span>,<span class="va">Status</span><span class="op">)</span></span>
<span></span>
<span><span class="va">world_map</span> <span class="op">&lt;-</span> <span class="va">world_map</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">freedom_2020_plot</span>,by<span class="op">=</span><span class="st">"region"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">world_map</span>, <span class="va">region</span>,<span class="va">Status</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">Status</span>,map_id <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_map.html" class="external-link">geom_map</a></span><span class="op">(</span>map <span class="op">=</span> <span class="va">world_map</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html" class="external-link">expand_limits</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">world_map</span><span class="op">$</span><span class="va">long</span>, y <span class="op">=</span> <span class="va">world_map</span><span class="op">$</span><span class="va">lat</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Latitude"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Longitude"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Countries by freedom status"</span>,</span>
<span>       caption<span class="op">=</span><span class="st">"Data comes from Freedom House via TidyTuesday"</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>                       end<span class="op">=</span><span class="fl">.8</span>,</span>
<span>                       option <span class="op">=</span> <span class="st">"plasma"</span>,</span>
<span>                       breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F"</span>,<span class="st">"PF"</span>,<span class="st">"NF"</span><span class="op">)</span>,</span>
<span>                       labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Free"</span>,<span class="st">"Partially Free"</span>,<span class="st">"Not free"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="my-vignette_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Plotting the distribution of the political freedom ranking and civil
liberties rankings as well as the average of the two, we see that
freedom status is almost entirely determined by the average of the
two.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">freedom</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>PR_CL <span class="op">=</span> <span class="op">(</span><span class="va">PR</span> <span class="op">+</span> <span class="va">CL</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">value_labs</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CL"</span><span class="op">=</span><span class="st">"Civil Liberties (CL)"</span>,<span class="st">"PR"</span><span class="op">=</span><span class="st">"Political Freedom (PR)"</span>,<span class="st">"PR_CL"</span><span class="op">=</span><span class="st">"Avg. of CL and PF (PR_CL)"</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">CL</span>,<span class="va">PR</span>,<span class="va">PR_CL</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">value</span>,fill<span class="op">=</span><span class="va">Status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>cols<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span>,scale<span class="op">=</span><span class="st">"free_x"</span>,labeller<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html" class="external-link">labeller</a></span><span class="op">(</span>name<span class="op">=</span><span class="va">value_labs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>                       end<span class="op">=</span><span class="fl">.8</span>,</span>
<span>                       option <span class="op">=</span> <span class="st">"plasma"</span>,</span>
<span>                       breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F"</span>,<span class="st">"PF"</span>,<span class="st">"NF"</span><span class="op">)</span>,</span>
<span>                       labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Free"</span>,<span class="st">"Partially Free"</span>,<span class="st">"Not free"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="my-vignette_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Now we use <code>rpart</code> to fit a classification tree using CL
and PR as predictors.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rpart_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rpart.html">rpart</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"class"</span>,<span class="va">Status</span><span class="op">~</span> <span class="va">CL</span> <span class="op">+</span> <span class="va">PR</span> <span class="op">+</span> <span class="va">PR_CL</span>, data<span class="op">=</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<p>We can use the <code>plot</code> method to visualize the tree, and
see that indeed the two splits correspond to what we see in the data
above.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rpart_mod</span>,margin<span class="op">=</span><span class="fl">.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="va">rpart_mod</span><span class="op">)</span></span></code></pre></div>
<p><img src="my-vignette_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Finally we can check our model by plotting the data with the decision
boundaries as fit by the rpart model. We can also get the predicted
status from the rpart model using the predict function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">CL</span>,<span class="va">PR</span>,<span class="va">Status</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>N<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">CL</span>,y<span class="op">=</span><span class="va">PR</span>,colour<span class="op">=</span><span class="va">Status</span>,size <span class="op">=</span> <span class="va">N</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="fl">2</span><span class="op">*</span><span class="fl">2.75</span>,slope<span class="op">=</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="fl">2</span><span class="op">*</span><span class="fl">5.25</span>,slope<span class="op">=</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>                       end<span class="op">=</span><span class="fl">.8</span>,</span>
<span>                       option <span class="op">=</span> <span class="st">"plasma"</span>,</span>
<span>                       breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F"</span>,<span class="st">"PF"</span>,<span class="st">"NF"</span><span class="op">)</span>,</span>
<span>                       labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Free"</span>,<span class="st">"Partially Free"</span>,<span class="st">"Not free"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="my-vignette_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>From this analysis we can confirm that the freedom status is based
primarily on the average of the political and civil liberty scores. We
have an accuracy of 99.6% with only 21 missclassified counties.</p>
<p>However, as the model is not entirely perfect, it is possible that
additional predictors are used or that the models may have differed over
time. We will try fitting rpart trees stratified by year.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_pred</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rpart_pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rpart_mod</span>,type<span class="op">=</span><span class="st">"class"</span><span class="op">)</span>,</span>
<span>               correct<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">rpart_pred</span><span class="op">==</span><span class="va">Status</span><span class="op">~</span> <span class="va">Status</span>,</span>
<span>                                 <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"Incorrect"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">accuracy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df_pred</span><span class="op">$</span><span class="va">correct</span><span class="op">!=</span><span class="st">"Incorrect"</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_pred</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">preds_by_year</span> <span class="op">&lt;-</span> <span class="va">df_pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">df_pred</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="fu"><a href="../reference/rpart.html">rpart</a></span><span class="op">(</span><span class="va">Status</span> <span class="op">~</span> <span class="va">PR_CL</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>,type<span class="op">=</span><span class="st">"class"</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span><span class="va">model</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">preds_by_year</span><span class="op">)</span>,<span class="va">preds_by_year</span>,ylab<span class="op">=</span><span class="st">"Accuracy"</span>,xlab<span class="op">=</span><span class="st">"Year"</span><span class="op">)</span></span></code></pre></div>
<p><img src="my-vignette_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>All years after 2002 have 100% accuracy indicating that we have
figured out how status is determined (either entirely or sufficiently
well). However,in 2002 and earlier there is some level of
missclassification. In order to figure out how status is determined in
these years, we would have to dig deeper into the data or
documentation.</p>
</div>
</div>
<div class="section level2">
<h2 id="for-grading">For grading:<a class="anchor" aria-label="anchor" href="#for-grading"></a>
</h2>
<p>two functions from purrr:</p>
<ul>
<li><p>map.</p></li>
<li><p>map_dbl.</p></li>
</ul>
<p><code>rpart</code> functions:</p>
<ul>
<li><p>rpart.</p></li>
<li><p>plot.rpart.</p></li>
<li><p>predict.rpart.</p></li>
</ul>
<p>Tidyverse functions used:</p>
<ul>
<li><p>filter.</p></li>
<li><p>left_join.</p></li>
<li><p>mutate.</p></li>
<li><p>select.</p></li>
<li><p>group_by.</p></li>
<li><p>summarize.</p></li>
</ul>
<p>ggplot geoms:</p>
<ul>
<li><p>geom_point.</p></li>
<li><p>geom_bar.</p></li>
<li><p>geom_map.</p></li>
<li><p>geom_abline.</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Terry Therneau, Beth Atkinson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7. Website build and example analysis by Grace Ringlein.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
